<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Doggy Viewer</title>
        <link rel="stylesheet" href="style.css">
        <link rel="icon" href="https://img.icons8.com/pastel-glyph/64/000000/dog-sit--v3.png"/>
        <!--Google Fonts-->
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Crete+Round&display=swap" rel="stylesheet">    
    </head>

    <body>
        <header><h1>Doggy Viewer</h1></header>

        <form id="form">
            <select id="breeds" name="breeds"></select>
            <input id="count" type="number" value="1">
            <input type="button" id="btn" value="VIEW">
        </form>

        <div class="content">
            <h1 id="doggos">
                Doggy: 
                <span id="breed-name"></span>
            </h1>

            <section id="img-container"></section>
        </div>

        <script>

            window.onload = function() {
                getBreeds();
            }

            function getBreeds() {
                var url = "https://dog.ceo/api/breeds/list/all";
                var xhttp = new XMLHttpRequest();

                xhttp.onreadystatechange = function()
                {
                    if (this.readyState == 4 && this.status == 200)
                    {
                        console.log("readyState == 4 && status == 200");
                        var response = JSON.parse(this.responseText);
                        var breedList = selectBreedList(response);
                        updateList(breedList);
                    }
                    else if (this.readyState == 4)
                    {
                        console.log("Error: status !== 200");
                    }
                };

                xhttp.open("GET", url, true);
                xhttp.send();
            }

           function selectBreedList(response) {
                if(response.status == "success") {
                    return Object.keys(response.message);
                }
           }

            function getImgCount() {
                var input = document.querySelector("#count");
                return input.value;
            }

            function getImages(breed) {
                var imgCount = getImgCount();
                var url = `https://dog.ceo/api/breed/${breed}/images/random/${imgCount}`;
                var xhttp = new XMLHttpRequest();

                xhttp.onreadystatechange = function()
                {
                    if(this.readyState == 4 && this.status == 200)
                    {
                        var response = JSON.parse(this.responseText);
                        var imageList = selectImageList(response);
                        updateImages(imageList);
                    }
                    else if (this.readyState == 4)
                    {
                        console.log("Error: status !== 200");
                    }
                };

                xhttp.open("GET", url, true);
                xhttp.send();
            }

            function selectImageList(response) {
                if(response.status == "success") {
                    return response.message;
                }
            }

            function updateImages(imageList) {
                var imgContainer = document.querySelector("#img-container");
                var selectBreeds = document.querySelector("#breeds");
                var name = document.querySelector("#breed-name");

                imgContainer.innerHTML = " ";
                name.innerHTML = selectBreeds.value;
                
                function createImgElement(url) {
                    var img = document.createElement("img");
                    img.src = url;
                    return img;
                }

                imageList.forEach(function(url) {
                    var img = createImgElement(url);
                    imgContainer.appendChild(img);
                });
            }

            function updateList(breedList) {
                var select = document.querySelector("#breeds");
                var btn = document.querySelector("#btn");

                function createOptions(name) {
                    var option = document.createElement("option");
                    option.value = name;
                    option.innerHTML = name;

                    return option;
                }

                breedList.forEach(function(breed) {
                    var breedOption = createOptions(breed);
                    select.appendChild(breedOption);
                });

                btn.onclick = function(e) {
                    var breed = select.value;
                    getImages(breed);
                };
            }

        </script>
    </body>
</html>